import{u as f,b as n,j as e,v,L as S,O as E,c as b,N as D,d as M}from"../shared/vscode.js";function k(){const{mode:s,setMode:d}=f(),[i,o]=n.useState(!1),c=()=>{d(s==="view"?"edit":"view")},l=u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),c())},g="mode-indicator-keybind",p=s==="view"?"Press I to switch to edit mode":"Press Esc to return to view mode";return e.jsxs("div",{style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"6px"},children:[e.jsxs("div",{onClick:c,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),onKeyDown:l,role:"button",tabIndex:0,"aria-describedby":i?g:void 0,style:{padding:"5px 10px",backgroundColor:s==="view"?"var(--vscode-editorInfo-background)":"var(--vscode-editorWarning-background)",color:s==="view"?"var(--vscode-editorInfo-foreground)":"var(--vscode-editorWarning-foreground)",border:"1px solid "+(s==="view"?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"),borderRadius:"3px",fontSize:"12px",fontWeight:"bold",cursor:"pointer",transition:"box-shadow 0.15s ease, transform 0.15s ease, filter 0.15s ease",boxShadow:i?`0 0 0 2px ${s==="view"?"var(--vscode-editorInfo-border)":"var(--vscode-editorWarning-border)"}`:void 0,transform:i?"translateY(-1px)":void 0,filter:i?"brightness(1.05)":void 0},children:["MODE: ",s.toUpperCase()]}),i&&e.jsx("div",{id:g,style:{padding:"6px 8px",backgroundColor:"var(--vscode-editorWidget-background)",color:"var(--vscode-editorWidget-foreground)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:"3px",fontSize:"11px",whiteSpace:"nowrap",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.25)",pointerEvents:"none"},children:p})]})}const h=n.createContext(null);function C(){const s=n.useContext(h);if(!s)throw new Error("DebugContext must be used inside a provider");return s}function W({debug:s,children:d}){return e.jsx(h.Provider,{value:{debug:s},children:d})}function K(){var l;const{debug:s}=C(),{selectedNodeId:d,selectedKey:i,parentNodeInfo:o,nodeMap:c}=f();return e.jsx(e.Fragment,{children:s&&e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",d]}),e.jsxs("p",{children:["selectedNodeType: ",(l=c.get(d??""))==null?void 0:l.type]}),e.jsxs("p",{children:["selectedKey: ",i]}),e.jsxs("p",{children:["parentNodeId: ",o==null?void 0:o.parent.id]}),e.jsxs("p",{children:["parentType: ",o==null?void 0:o.parent.type]}),e.jsxs("p",{children:["parentKey: ",o==null?void 0:o.key]}),e.jsxs("p",{children:["parentIndex: ",o==null?void 0:o.index]})]})})}function L(){const[s,d]=n.useState(void 0),[i,o]=n.useState(null),[c,l]=n.useState(null),[g,p]=n.useState(null),[u,y]=n.useState(null),[j,m]=n.useState(!1);n.useEffect(()=>{const r=a=>{console.log("event:",a);const t=a.data;console.log("message:",t),t.type==="update"?d(t.contents):t.type==="availableInserts"?y(t.contents):t.type==="toggleDebug"&&(console.log("Toggling debug mode"),m(x=>!x))};return window.addEventListener("message",r),v.postMessage({type:"ready"}),()=>{window.removeEventListener("message",r)}},[]);const w=(r,a)=>{const t={type:"nodeEdit",contents:r,key:a};d(x=>x&&{...x}),console.log("sending message: ",t),v.postMessage(t)},I=(r,a)=>{const t={type:"requestAvailableInserts",nodeId:r,nodeKey:a};console.log("requesting available inserts: ",t),v.postMessage(t)};return e.jsx(e.Fragment,{children:e.jsx(W,{debug:j,children:s?e.jsxs(S,{sourceFile:s,onEdit:w,onRequestAvailableInserts:I,availableInserts:u,selectedNodeId:i,selectedKey:c,parentNodeInfo:g,setSelectedNodeId:o,setSelectedKey:l,setParentNodeInfo:p,children:[e.jsx(k,{}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:s==null?void 0:s.code.map((r,a)=>e.jsx(E,{node:r,parentInfo:b(s,"code",a),children:e.jsx(D,{node:r,parentInfo:b(s,"code",a)})},r.id))}),e.jsx(K,{})]}):e.jsx("p",{children:"loading..."})})})}M.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(L,{})}));
