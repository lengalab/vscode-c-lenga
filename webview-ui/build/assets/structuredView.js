var E=Object.defineProperty;var M=(e,n,s)=>n in e?E(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s;var F=(e,n,s)=>M(e,typeof n!="symbol"?n+"":n,s);import{b as d,j as t,R as h,c as b}from"./client.js";const C=d.createContext(null);function l(){const e=d.useContext(C);if(!e)throw new Error("LineContext must be used inside a provider");return e}function N(e){return{nodeMap:new Map,parentMap:new Map}}function a(e,n){const{selectedNodeId:s,selectedKey:r,onEdit:c,setSelectedNodeId:u,setSelectedKey:m}=l(),j=s==e.id&&r&&r==n,[x,i]=h.useState(String(e[n]??""));h.useEffect(()=>{i(String(e[n]??""))},[e,n]);const p=Math.max(1,x.length)+"ch";return t.jsx("input",{className:"inline-editor",style:{...j?{backgroundColor:"rgba(255, 255, 255, 0.05)",boxShadow:"inset 0 -1px 0 0 rgba(163, 209, 252, 0.5)"}:{},width:p},value:x,onChange:g=>i(g.target.value),onFocus:()=>{m(n),u(e.id)},onBlur:()=>{e[n]=x,c(e,n)}})}function R({indent:e,node:n,children:s}){const{selectedNodeId:r,setSelectedNodeId:c}=l(),u=r===n.id;return t.jsx("div",{className:`object-container ${u?"object-selected":""}`,style:{paddingLeft:`${e*20}px`},onClick:()=>c(n.id),tabIndex:0,children:s})}function o({node:e,indent:n}){switch(e.type){case"PreprocInclude":return t.jsx(y,{includeDecl:e});case"FunctionParameter":return t.jsx(S,{paramDecl:e});case"FunctionDeclaration":return t.jsx(A,{functionDeclaration:e});case"FunctionDefinition":return t.jsx(L,{funcDef:e,indent:n});case"Declaration":return t.jsx(w,{varDecl:e});case"ReturnStatement":return t.jsx(V,{returnStmt:e});case"CompoundStatement":return t.jsx(f,{compStmt:e,indent:n});case"IfStatement":return t.jsx(P,{ifStatement:e,indent:n});case"ElseClause":return t.jsx(I,{elseClause:e,indent:n});case"CallExpression":return t.jsx(_,{callExpr:e});case"Reference":return t.jsx(K,{declRefExpr:e});case"AssignmentExpression":return t.jsx(B,{assignmentExpr:e});case"NumberLiteral":return t.jsx(O,{literalExpr:e});case"StringLiteral":return t.jsx(T,{literalExpr:e});case"BinaryExpression":return t.jsx($,{binaryExpression:e});default:return"WIP"}}function y({includeDecl:e}){return t.jsxs(t.Fragment,{children:["#include"," ","<",a(e,"directive"),">",";"]})}function A({functionDeclaration:e}){const{nodeMap:n}=l();return n.set(e.id,e),t.jsx(t.Fragment,{children:t.jsxs(t.Fragment,{children:[a(e,"return_type")," ",a(e,"name"),"(",e.params.map((s,r)=>t.jsxs(h.Fragment,{children:[r>0&&", ",t.jsx(S,{paramDecl:s})]},s.id)),")"]})})}function L({funcDef:e,indent:n}){const{nodeMap:s}=l();return s.set(e.id,e),t.jsxs(t.Fragment,{children:[a(e,"return_type")," ",a(e,"name"),"(",e.params.map((r,c)=>t.jsxs(h.Fragment,{children:[c>0&&", ",t.jsx(S,{paramDecl:r})]},r.id)),")",e.body&&t.jsx(f,{compStmt:e.body,indent:n})]})}function w({varDecl:e}){const{nodeMap:n}=l();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[a(e,"data_type")," ",a(e,"name"),e.initializer&&t.jsxs(t.Fragment,{children:[" ","="," ",t.jsx(o,{node:e.initializer,indent:0})]}),";"]})}function S({paramDecl:e}){const{nodeMap:n}=l();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[a(e,"data_type")," ",a(e,"name")]})}function f({compStmt:e,indent:n}){return t.jsxs(t.Fragment,{children:["{",e.statements.map(s=>t.jsx(R,{indent:n+1,node:s,children:t.jsx(o,{node:s,indent:n})})),"}"]})}function P({ifStatement:e,indent:n}){return t.jsxs(t.Fragment,{children:["if"," ","(",t.jsx(o,{node:e.condition,indent:0}),")"," ",t.jsx(f,{compStmt:e.compoundStatement,indent:n}),e.elseClause&&t.jsx(I,{elseClause:e.elseClause,indent:n})]})}function I({elseClause:e,indent:n}){return t.jsxs(t.Fragment,{children:["else"," ",t.jsx(f,{compStmt:e.compoundStatement,indent:n})]})}function V({returnStmt:e}){return t.jsxs(t.Fragment,{children:["return",e.expression&&t.jsxs(t.Fragment,{children:[" ",t.jsx(o,{node:e.expression,indent:0})]}),";"]})}function _({callExpr:e}){return t.jsxs(t.Fragment,{children:[a(e,"identifier"),"(",e.args.map((n,s)=>t.jsxs(h.Fragment,{children:[s>0&&", ",t.jsx(o,{node:n,indent:0})]},n.id)),")",";"]})}function K({declRefExpr:e}){const{nodeMap:n}=l(),s=n.get(e.DeclRefId);return!s||!("name"in s)?t.jsx(t.Fragment,{children:e.DeclRefId}):t.jsx(t.Fragment,{children:s.name})}function B({assignmentExpr:e}){const{nodeMap:n}=l(),s=n.get(e.id_reference);return!s||!("name"in s)?t.jsx(t.Fragment,{children:e.id_reference}):t.jsxs(t.Fragment,{children:[s.name," ","="," ",t.jsx(o,{node:e.value,indent:0})]})}function O({literalExpr:e}){return t.jsx(t.Fragment,{children:a(e,"value")})}function T({literalExpr:e}){return t.jsxs(t.Fragment,{children:['"',a(e,"value"),'"']})}function $({binaryExpression:e}){return t.jsxs(t.Fragment,{children:[t.jsx(o,{node:e.left,indent:0}),e.operator,t.jsx(o,{node:e.right,indent:0})]})}function q({ast:e,onEdit:n,selectedNodeId:s,selectedKey:r,setSelectedNodeId:c,setSelectedKey:u,insertTargetId:m,setInsertTargetId:j,children:x}){const{nodeMap:i,parentMap:p}=d.useMemo(()=>N(),[e]);return t.jsx(C.Provider,{value:{onEdit:n,selectedNodeId:s,selectedKey:r,setSelectedNodeId:c,setSelectedKey:u,nodeMap:i,parentMap:p,insertTargetId:m,setInsertTargetId:j},children:x})}class z{constructor(){F(this,"vsCodeApi");typeof acquireVsCodeApi=="function"&&(this.vsCodeApi=acquireVsCodeApi())}postMessage(n){this.vsCodeApi?this.vsCodeApi.postMessage(n):console.log(n)}getState(){if(this.vsCodeApi)return this.vsCodeApi.getState();{const n=localStorage.getItem("vscodeState");return n?JSON.parse(n):void 0}}setState(n){return this.vsCodeApi?this.vsCodeApi.setState(n):(localStorage.setItem("vscodeState",JSON.stringify(n)),n)}}const J=new z;function W(){const[e,n]=d.useState([]),[s,r]=d.useState(null),[c,u]=d.useState(null),[m,j]=d.useState(null);d.useEffect(()=>{const i=p=>{const g=p.data;n(g.contents)};return window.addEventListener("message",i),J.postMessage({type:"ready"}),()=>{window.removeEventListener("message",i)}},[]);const x=(i,p)=>{const g={type:"nodeEdit",contents:i,key:p};n(v=>[...v]),console.log("sending message: ",g)};return t.jsxs(t.Fragment,{children:[t.jsx(q,{ast:e,onEdit:x,selectedNodeId:s,selectedKey:c,setSelectedNodeId:r,setSelectedKey:u,insertTargetId:m,setInsertTargetId:j,children:t.jsx("div",{children:e.map(i=>t.jsx(R,{indent:0,node:i,children:t.jsx(o,{node:i,indent:0},i.id)}))})}),t.jsxs("div",{children:[t.jsx("h1",{children:"Debug Info"}),t.jsxs("p",{children:["selectedNodeId: ",s]}),t.jsxs("p",{children:["selectedKey: ",c]}),t.jsxs("p",{children:["insertTargetId: ",m]})]})]})}b.createRoot(document.getElementById("root")).render(t.jsx(d.StrictMode,{children:t.jsx(W,{})}));
