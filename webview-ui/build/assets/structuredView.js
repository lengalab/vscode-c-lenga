var M=Object.defineProperty;var b=(e,n,s)=>n in e?M(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s;var F=(e,n,s)=>b(e,typeof n!="symbol"?n+"":n,s);import{b as d,j as t,R as h,c as N}from"./client.js";const R=d.createContext(null);function l(){const e=d.useContext(R);if(!e)throw new Error("LineContext must be used inside a provider");return e}function y(e){return{nodeMap:new Map,parentMap:new Map}}function a(e,n){const{selectedNodeId:s,selectedKey:r,onEdit:c,setSelectedNodeId:u,setSelectedKey:j}=l(),g=s==e.id&&r&&r==n,[x,i]=h.useState(String(e[n]??""));h.useEffect(()=>{i(String(e[n]??""))},[e,n]);const p=Math.max(1,x.length)+"ch";return t.jsx("input",{className:"inline-editor",style:{...g?{backgroundColor:"rgba(255, 255, 255, 0.05)",boxShadow:"inset 0 -1px 0 0 rgba(163, 209, 252, 0.5)"}:{},width:p},value:x,onChange:m=>i(m.target.value),onFocus:()=>{j(n),u(e.id)},onBlur:()=>{e[n]=x,c(e,n)}})}function I({indent:e,node:n,children:s}){const{selectedNodeId:r,setSelectedNodeId:c}=l(),u=r===n.id;return t.jsx("div",{className:`object-container ${u?"object-selected":""}`,style:{paddingLeft:`${e*20}px`},onClick:()=>c(n.id),tabIndex:0,children:s})}function o({node:e,indent:n}){switch(e.type){case"PreprocInclude":return t.jsx(A,{includeDecl:e});case"FunctionParameter":return t.jsx(S,{paramDecl:e});case"FunctionDeclaration":return t.jsx(L,{functionDeclaration:e});case"FunctionDefinition":return t.jsx(w,{funcDef:e,indent:n});case"Declaration":return t.jsx(P,{varDecl:e});case"ReturnStatement":return t.jsx(_,{returnStmt:e});case"CompoundStatement":return t.jsx(f,{compStmt:e,indent:n});case"IfStatement":return t.jsx(V,{ifStatement:e,indent:n});case"ElseClause":return t.jsx(v,{elseClause:e,indent:n});case"CallExpression":return t.jsx(K,{callExpr:e});case"Reference":return t.jsx(B,{declRefExpr:e});case"AssignmentExpression":return t.jsx(O,{assignmentExpr:e});case"NumberLiteral":return t.jsx(T,{literalExpr:e});case"StringLiteral":return t.jsx($,{literalExpr:e});case"BinaryExpression":return t.jsx(q,{binaryExpression:e});default:return"WIP"}}function A({includeDecl:e}){return t.jsxs(t.Fragment,{children:["#include"," ","<",a(e,"directive"),">",";"]})}function L({functionDeclaration:e}){const{nodeMap:n}=l();return n.set(e.id,e),t.jsx(t.Fragment,{children:t.jsxs(t.Fragment,{children:[a(e,"return_type")," ",a(e,"name"),"(",e.params.map((s,r)=>t.jsxs(h.Fragment,{children:[r>0&&", ",t.jsx(S,{paramDecl:s})]},s.id)),")"]})})}function w({funcDef:e,indent:n}){const{nodeMap:s}=l();return s.set(e.id,e),t.jsxs(t.Fragment,{children:[a(e,"return_type")," ",a(e,"name"),"(",e.params.map((r,c)=>t.jsxs(h.Fragment,{children:[c>0&&", ",t.jsx(S,{paramDecl:r})]},r.id)),")",e.body&&t.jsx(f,{compStmt:e.body,indent:n})]})}function P({varDecl:e}){const{nodeMap:n}=l();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[a(e,"data_type")," ",a(e,"name"),e.initializer&&t.jsxs(t.Fragment,{children:[" ","="," ",t.jsx(o,{node:e.initializer,indent:0})]}),";"]})}function S({paramDecl:e}){const{nodeMap:n}=l();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[a(e,"data_type")," ",a(e,"name")]})}function f({compStmt:e,indent:n}){return t.jsxs(t.Fragment,{children:["{",e.statements.map(s=>t.jsx(I,{indent:n+1,node:s,children:t.jsx(o,{node:s,indent:n})})),"}"]})}function V({ifStatement:e,indent:n}){return t.jsxs(t.Fragment,{children:["if"," ","(",t.jsx(o,{node:e.condition,indent:0}),")"," ",t.jsx(f,{compStmt:e.compoundStatement,indent:n}),e.elseClause&&t.jsx(v,{elseClause:e.elseClause,indent:n})]})}function v({elseClause:e,indent:n}){return t.jsxs(t.Fragment,{children:["else"," ",t.jsx(f,{compStmt:e.compoundStatement,indent:n})]})}function _({returnStmt:e}){return t.jsxs(t.Fragment,{children:["return",e.expression&&t.jsxs(t.Fragment,{children:[" ",t.jsx(o,{node:e.expression,indent:0})]}),";"]})}function K({callExpr:e}){return t.jsxs(t.Fragment,{children:[a(e,"identifier"),"(",e.args.map((n,s)=>t.jsxs(h.Fragment,{children:[s>0&&", ",t.jsx(o,{node:n,indent:0})]},n.id)),")",";"]})}function B({declRefExpr:e}){const{nodeMap:n}=l(),s=n.get(e.DeclRefId);return!s||!("name"in s)?t.jsx(t.Fragment,{children:e.DeclRefId}):t.jsx(t.Fragment,{children:s.name})}function O({assignmentExpr:e}){const{nodeMap:n}=l(),s=n.get(e.id_reference);return!s||!("name"in s)?t.jsx(t.Fragment,{children:e.id_reference}):t.jsxs(t.Fragment,{children:[s.name," ","="," ",t.jsx(o,{node:e.value,indent:0})]})}function T({literalExpr:e}){return t.jsx(t.Fragment,{children:a(e,"value")})}function $({literalExpr:e}){return t.jsxs(t.Fragment,{children:['"',a(e,"value"),'"']})}function q({binaryExpression:e}){return t.jsxs(t.Fragment,{children:[t.jsx(o,{node:e.left,indent:0}),e.operator,t.jsx(o,{node:e.right,indent:0})]})}function z({ast:e,onEdit:n,selectedNodeId:s,selectedKey:r,setSelectedNodeId:c,setSelectedKey:u,insertTargetId:j,setInsertTargetId:g,children:x}){const{nodeMap:i,parentMap:p}=d.useMemo(()=>y(),[e]);return t.jsx(R.Provider,{value:{onEdit:n,selectedNodeId:s,selectedKey:r,setSelectedNodeId:c,setSelectedKey:u,nodeMap:i,parentMap:p,insertTargetId:j,setInsertTargetId:g},children:x})}class J{constructor(){F(this,"vsCodeApi");typeof acquireVsCodeApi=="function"&&(this.vsCodeApi=acquireVsCodeApi())}postMessage(n){this.vsCodeApi?this.vsCodeApi.postMessage(n):console.log(n)}getState(){if(this.vsCodeApi)return this.vsCodeApi.getState();{const n=localStorage.getItem("vscodeState");return n?JSON.parse(n):void 0}}setState(n){return this.vsCodeApi?this.vsCodeApi.setState(n):(localStorage.setItem("vscodeState",JSON.stringify(n)),n)}}const C=new J;function W(){const[e,n]=d.useState([]),[s,r]=d.useState(null),[c,u]=d.useState(null),[j,g]=d.useState(null);d.useEffect(()=>{const i=p=>{const m=p.data;console.log("got message: ",m),n(m.contents)};return window.addEventListener("message",i),C.postMessage({type:"ready"}),()=>{window.removeEventListener("message",i)}},[]);const x=(i,p)=>{const m={type:"nodeEdit",contents:i,key:p};n(E=>[...E]),console.log("sending message: ",m),C.postMessage(m)};return t.jsxs(t.Fragment,{children:[t.jsx(z,{ast:e,onEdit:x,selectedNodeId:s,selectedKey:c,setSelectedNodeId:r,setSelectedKey:u,insertTargetId:j,setInsertTargetId:g,children:t.jsx("div",{children:e.map(i=>t.jsx(I,{indent:0,node:i,children:t.jsx(o,{node:i,indent:0},i.id)}))})}),t.jsxs("div",{children:[t.jsx("h1",{children:"Debug Info"}),t.jsxs("p",{children:["selectedNodeId: ",s]}),t.jsxs("p",{children:["selectedKey: ",c]}),t.jsxs("p",{children:["insertTargetId: ",j]})]})]})}N.createRoot(document.getElementById("root")).render(t.jsx(d.StrictMode,{children:t.jsx(W,{})}));
