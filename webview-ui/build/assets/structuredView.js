import{b as x,j as t,R as b,c as N}from"./client.js";const U=x.createContext(null);function f(){const e=x.useContext(U);if(!e)throw new Error("LineContext must be used inside a provider");return e}function M(e){const n=new Map,s=new Map;function i(r,l=null,p="",y=0){if(r)switch(n.set(r.id,r),l&&s.set(r.id,{parent:l,key:p,index:y}),r.type){case"FunctionDeclaration":{const a=r;a.params.forEach((c,u)=>i(c,a,"params",u));break}case"FunctionDefinition":{const a=r;a.params.forEach((c,u)=>i(c,a,"params",u)),i(a.body,r,"body",0);break}case"CompoundStatement":{r.statements.forEach((c,u)=>i(c,r,"statements",u));break}case"Declaration":{const a=r;a.initializer&&i(a.initializer,a,"initializer",0);break}case"ReturnStatement":{const a=r;a.expression&&i(a.expression,a,"expression",0);break}case"CallExpression":{const a=r;i(a,a,"calle",0),a.args.forEach((c,u)=>i(c,a,"args",u));break}case"AssignmentExpression":{i(r.value,r,"value",0);break}}}return e.forEach(r=>i(r)),{nodeMap:n,parentMap:s}}function P({ast:e,onEdit:n,selectedNodeId:s,setSelectedNodeId:i,insertTargetId:r,setInsertTargetId:l,children:p}){const{nodeMap:y,parentMap:a}=x.useMemo(()=>M(e),[e]);return t.jsx(U.Provider,{value:{onEdit:n,selectedNodeId:s,setSelectedNodeId:i,nodeMap:y,parentMap:a,insertTargetId:r,setInsertTargetId:l},children:p})}function m(e,n){const{onEdit:s}=f(),[i,r]=b.useState(String(e[n]??""));return b.useEffect(()=>{r(String(e[n]??""))},[e,n]),t.jsx("input",{className:"inline-editor",value:i,size:Math.max(1,i.length),onChange:l=>r(l.target.value),onInput:l=>{const p=l.target;p.size=Math.max(1,p.value.length)},onBlur:()=>{e[n]=i,s(e)}})}function j({indent:e,node:n,children:s}){const{selectedNodeId:i,setSelectedNodeId:r,insertTargetId:l,setInsertTargetId:p,onEdit:y,nodeMap:a,parentMap:c}=f(),u=i===n.id,E=l===n.id,C=h=>{u&&h.key==="Enter"&&(h.preventDefault(),p(n.id))},S=h=>{if(!n)return;let o;switch(h){case"Declaration":{const d={id:crypto.randomUUID(),type:"StringLiteral",value:""};o={id:crypto.randomUUID(),type:"Declaration",data_type:"",name:"",initializer:d};break}case"ReturnStatement":{o={id:crypto.randomUUID(),type:"ReturnStatement",expression:void 0};break}case"UnknownNode":{o={id:crypto.randomUUID(),type:"UnknownNode",contents:""};break}case"PreprocInclude":{o={id:crypto.randomUUID(),type:"PreprocInclude",directive:""};break}case"FunctionParameter":{o={id:crypto.randomUUID(),type:"FunctionParameter",name:"",data_type:""};break}case"FunctionDeclaration":{o={id:crypto.randomUUID(),type:"FunctionDeclaration",name:"",return_type:"",params:[]};break}case"FunctionDefinition":{o={id:crypto.randomUUID(),type:"FunctionDefinition",name:"",return_type:"",params:[],body:{id:crypto.randomUUID(),type:"CompoundStatement",statements:[]}};break}case"CompoundStatement":{o={id:crypto.randomUUID(),type:"CompoundStatement",statements:[]};break}case"CallExpression":{o={id:crypto.randomUUID(),type:"CallExpression",identifier:"",idDeclaration:"",args:[]};break}case"Reference":{o={id:crypto.randomUUID(),type:"Reference",DeclRefId:""};break}case"AssignmentExpression":{o={id:crypto.randomUUID(),type:"AssignmentExpression",id_reference:"",value:{id:crypto.randomUUID(),type:"StringLiteral",value:""}};break}case"NumberLiteral":{o={id:crypto.randomUUID(),type:"NumberLiteral",value:""};break}case"StringLiteral":{o={id:crypto.randomUUID(),type:"StringLiteral",value:""};break}}const I=c.get(n.id);if(!I)return;const{parent:g,key:v,index:D}=I;if(!g||!("statements"in g))return;const F=g.statements,L=[...F.slice(0,D+1),o,...F.slice(D+1)];g.statements=L,a.set(o.id,o),c.set(o.id,{parent:g,key:v,index:D+1}),p(null),y(g)};return t.jsxs("div",{tabIndex:0,onClick:()=>r(n.id),onKeyDown:C,style:{backgroundColor:u?"rgba(116, 116, 116, 0.05)":"transparent"},children:[t.jsxs("div",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace"},children:["    ".repeat(e),s]}),E&&t.jsxs("div",{style:{border:"1px solid #ccc",background:"black",position:"absolute"},children:[t.jsx("div",{onClick:()=>S("Declaration"),children:"Declaration"}),t.jsx("div",{onClick:()=>S("ReturnStatement"),children:"ReturnStatement"})]})]})}function w({node:e,indent:n}){switch(e.type){case"PreprocInclude":return t.jsx(A,{includeDecl:e,indent:n});case"FunctionParameter":return t.jsx(R,{paramDecl:e});case"FunctionDeclaration":throw new Error("Not implemented");case"FunctionDefinition":return t.jsx(_,{funcDef:e,indent:n});case"Declaration":return t.jsx(z,{varDecl:e,indent:n});case"ReturnStatement":return t.jsx(T,{returnStmt:e,indent:n});case"CompoundStatement":return t.jsx(k,{compStmt:e,indent:n});case"CallExpression":return t.jsx(V,{callExpr:e});case"Reference":return t.jsx(O,{declRefExpr:e});case"AssignmentExpression":return t.jsx(B,{assignmentExpr:e});case"NumberLiteral":return t.jsx(K,{literalExpr:e});case"StringLiteral":return t.jsx(W,{literalExpr:e});default:return"WIP"}}function A({includeDecl:e,indent:n}){return t.jsx(j,{indent:n,node:e,children:t.jsxs(t.Fragment,{children:["#include ","<",m(e,"directive"),">",";"]})})}function _({funcDef:e,indent:n}){const{nodeMap:s}=f();return s.set(e.id,e),t.jsxs(t.Fragment,{children:[t.jsx(j,{indent:n,node:e,children:t.jsxs(t.Fragment,{children:[m(e,"return_type"),m(e,"name"),"(",e.params.map((i,r)=>t.jsxs(b.Fragment,{children:[r>0&&", ",t.jsx(R,{paramDecl:i})]},i.id)),")","{"]})}),e.body&&t.jsx(k,{compStmt:e.body,indent:n+1}),t.jsx(j,{indent:n,node:e,children:"}"})]})}function z({varDecl:e,indent:n}){const{nodeMap:s}=f();return s.set(e.id,e),t.jsxs(j,{indent:n,node:e,children:[m(e,"data_type"),m(e,"name"),e.initializer&&t.jsxs(t.Fragment,{children:["= ",t.jsx(w,{node:e.initializer,indent:n})]}),";"]})}function R({paramDecl:e}){const{nodeMap:n}=f();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[m(e,"data_type"),m(e,"name")]})}function k({compStmt:e,indent:n}){return e.statements.map(s=>t.jsx(w,{node:s,indent:n}))}function T({returnStmt:e,indent:n}){return t.jsxs(j,{indent:n,node:e,children:["return",e.expression&&t.jsxs(t.Fragment,{children:[" ",t.jsx(w,{node:e.expression,indent:0})]}),";"]})}function V({callExpr:e}){return t.jsxs(t.Fragment,{children:[m(e,"identifier"),"(",e.args.map((n,s)=>t.jsxs(b.Fragment,{children:[s>0&&", ",t.jsx(w,{node:n,indent:0})]},n.id)),");"]})}function O({declRefExpr:e}){const{nodeMap:n}=f(),s=n.get(e.DeclRefId);return!s||!("name"in s)?t.jsx(t.Fragment,{children:e.DeclRefId}):t.jsx(t.Fragment,{children:s.name})}function B({assignmentExpr:e}){return t.jsxs(t.Fragment,{children:["TODO assignmentExpr. node id: ",e.id]})}function K({literalExpr:e}){return t.jsx(t.Fragment,{children:m(e,"value")})}function W({literalExpr:e}){return t.jsx(t.Fragment,{children:m(e,"value")})}function $(){const[e,n]=x.useState([]),[s,i]=x.useState(null),[r,l]=x.useState(null),y=[{id:"0",name:"main",type:"FunctionDefinition",return_type:"int",params:[{type:"FunctionParameter",id:"1",name:"argv",data_type:"int"}],body:{id:"2",type:"CompoundStatement",statements:[{id:"3",type:"Declaration",name:"myVar",data_type:"int",initializer:{id:"4",type:"NumberLiteral",value:"58"}}]}}];x.useEffect(()=>{n(y)},[]);const a=c=>{const u={type:"nodeEdit",contents:c};n(E=>[...E]),console.log("sending message: ",u)};return t.jsx(P,{ast:e,onEdit:a,selectedNodeId:s,setSelectedNodeId:i,insertTargetId:r,setInsertTargetId:l,children:t.jsx("div",{children:e.map(c=>t.jsx(w,{node:c,indent:0},c.id))})})}N.createRoot(document.getElementById("root")).render(t.jsx(x.StrictMode,{children:t.jsx($,{})}));
