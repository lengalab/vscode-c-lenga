var C=Object.defineProperty;var R=(s,n,t)=>n in s?C(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var k=(s,n,t)=>R(s,typeof n!="symbol"?n+"":n,t);import{b as d,j as e,R as h,c as E}from"./client.js";const y=d.createContext(null);function u(){const s=d.useContext(y);if(!s)throw new Error("LineContext must be used inside a provider");return s}function I(s){return{nodeMap:new Map,parentMap:new Map}}function i({node:s,field:n,className:t}){const{onEdit:r,setSelectedNodeId:c,setSelectedKey:x}=u(),[o,m]=h.useState(String(s[n]??""));h.useEffect(()=>{m(String(s[n]??""))},[s,n]);const p=Math.max(1,o.length)+"ch";return e.jsx("input",{className:`inline-editor ${t??""}`,style:{width:p},value:o,onChange:a=>m(a.target.value),onFocus:()=>{x(n),c(s.id)},onBlur:()=>{s[n]=o,r(s,n)}})}function F({indent:s,node:n,children:t}){const{selectedNodeId:r,setSelectedNodeId:c}=u(),x=r===n.id;return e.jsx("div",{className:`object-container ${x?"object-selected":""}`,style:{paddingLeft:`${s*20}px`},onClick:o=>{o.stopPropagation(),c(n.id)},tabIndex:0,children:t})}function l({node:s,indent:n}){switch(s.type){case"PreprocInclude":return e.jsx(M,{includeDecl:s});case"FunctionParameter":return e.jsx(N,{paramDecl:s});case"FunctionDeclaration":return e.jsx(b,{functionDeclaration:s});case"FunctionDefinition":return e.jsx(w,{funcDef:s,indent:n});case"Declaration":return e.jsx(A,{varDecl:s});case"ReturnStatement":return e.jsx(P,{returnStmt:s});case"CompoundStatement":return e.jsx(f,{compStmt:s,indent:n});case"IfStatement":return e.jsx(L,{ifStatement:s,indent:n});case"ElseClause":return e.jsx(v,{elseClause:s,indent:n});case"CallExpression":return e.jsx(V,{callExpr:s});case"Reference":return e.jsx(_,{declRefExpr:s});case"AssignmentExpression":return e.jsx(B,{assignmentExpr:s});case"NumberLiteral":return e.jsx(K,{literalExpr:s});case"StringLiteral":return e.jsx($,{literalExpr:s});case"BinaryExpression":return e.jsx(O,{binaryExpression:s});default:return"WIP"}}function M({includeDecl:s}){return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"token-keyword",children:"#include"})," ",e.jsx("span",{className:"token-string",children:"<"}),e.jsx(i,{node:s,field:"directive",className:"token-string"}),e.jsx("span",{className:"token-string",children:">"})]})}function b({functionDeclaration:s}){const{nodeMap:n}=u();return n.set(s.id,s),e.jsx(e.Fragment,{children:e.jsxs(e.Fragment,{children:[e.jsx(i,{node:s,field:"return_type",className:"token-type"})," ",e.jsx(i,{node:s,field:"name",className:"token-function"}),e.jsx("span",{className:"token-delimiter",children:"("}),s.params.map((t,r)=>e.jsxs(h.Fragment,{children:[r>0&&", ",e.jsx(N,{paramDecl:t})]},t.id)),e.jsx("span",{className:"token-delimiter",children:")"})]})})}function w({funcDef:s,indent:n}){const{nodeMap:t}=u();return t.set(s.id,s),e.jsxs(e.Fragment,{children:[e.jsx(i,{node:s,field:"return_type",className:"token-type"})," ",e.jsx(i,{node:s,field:"name",className:"token-function"}),e.jsx("span",{className:"token-delimiter",children:"("}),s.params.map((r,c)=>e.jsxs(h.Fragment,{children:[c>0&&", ",e.jsx(N,{paramDecl:r})]},r.id)),e.jsx("span",{className:"token-delimiter",children:")"}),s.body&&e.jsx(f,{compStmt:s.body,indent:n})]})}function A({varDecl:s}){const{nodeMap:n}=u();return n.set(s.id,s),e.jsxs(e.Fragment,{children:[e.jsx(i,{node:s,field:"data_type",className:"token-type"})," ",e.jsx(i,{node:s,field:"name",className:"token-variable"}),s.initializer&&e.jsxs(e.Fragment,{children:[" ","="," ",e.jsx(l,{node:s.initializer,indent:0})]}),";"]})}function N({paramDecl:s}){const{nodeMap:n}=u();return n.set(s.id,s),e.jsxs(e.Fragment,{children:[e.jsx(i,{node:s,field:"data_type",className:"token-type"})," ",e.jsx(i,{node:s,field:"name",className:"token-variable"})]})}function f({compStmt:s,indent:n}){return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"token-delimiter",children:"{"}),s.statements.map(t=>e.jsx(F,{indent:n+1,node:t,children:e.jsx(l,{node:t,indent:n})})),e.jsx("span",{className:"token-delimiter",children:"}"})]})}function L({ifStatement:s,indent:n}){return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"token-keyword",children:"if"})," ",e.jsx("span",{className:"token-keyword",children:"("}),e.jsx(l,{node:s.condition,indent:0}),e.jsx("span",{className:"token-keyword",children:")"})," ",e.jsx(f,{compStmt:s.compoundStatement,indent:n}),s.elseClause&&e.jsx(v,{elseClause:s.elseClause,indent:n})]})}function v({elseClause:s,indent:n}){return e.jsxs(e.Fragment,{children:[" ",e.jsx("span",{className:"token-keyword",children:"else"})," ",e.jsx(f,{compStmt:s.compoundStatement,indent:n})]})}function P({returnStmt:s}){return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"token-keyword",children:"return"}),s.expression&&e.jsxs(e.Fragment,{children:[" ",e.jsx(l,{node:s.expression,indent:0})]}),";"]})}function V({callExpr:s}){return e.jsxs(e.Fragment,{children:[e.jsx(i,{node:s,field:"identifier",className:"token-function"}),e.jsx("span",{className:"token-delimiter",children:"("}),s.args.map((n,t)=>e.jsxs(h.Fragment,{children:[t>0&&", ",e.jsx(l,{node:n,indent:0})]},n.id)),e.jsx("span",{className:"token-delimiter",children:")"}),";"]})}function _({declRefExpr:s}){const{nodeMap:n}=u(),t=n.get(s.DeclRefId);return!t||!("name"in t)?e.jsx(e.Fragment,{children:s.DeclRefId}):e.jsx("span",{className:"token-variable",children:String(t.name)})}function B({assignmentExpr:s}){const{nodeMap:n}=u(),t=n.get(s.id_reference);return!t||!("name"in t)?e.jsx(e.Fragment,{children:s.id_reference}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"token-variable",children:String(t.name)})," ","="," ",e.jsx(l,{node:s.value,indent:0})]})}function K({literalExpr:s}){return e.jsx(i,{node:s,field:"value",className:"token-number"})}function $({literalExpr:s}){return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"token-string",children:'"'}),e.jsx(i,{node:s,field:"value",className:"token-string"}),e.jsx("span",{className:"token-string",children:'"'})]})}function O({binaryExpression:s}){return e.jsxs(e.Fragment,{children:[e.jsx(l,{node:s.left,indent:0})," ",s.operator," ",e.jsx(l,{node:s.right,indent:0})]})}function T({ast:s,onEdit:n,selectedNodeId:t,selectedKey:r,setSelectedNodeId:c,setSelectedKey:x,insertTargetId:o,setInsertTargetId:m,children:p}){const{nodeMap:a,parentMap:j}=d.useMemo(()=>I(),[s]);return e.jsx(y.Provider,{value:{onEdit:n,selectedNodeId:t,selectedKey:r,setSelectedNodeId:c,setSelectedKey:x,nodeMap:a,parentMap:j,insertTargetId:o,setInsertTargetId:m},children:p})}class q{constructor(){k(this,"vsCodeApi");typeof acquireVsCodeApi=="function"&&(this.vsCodeApi=acquireVsCodeApi())}postMessage(n){this.vsCodeApi?this.vsCodeApi.postMessage(n):console.log(n)}getState(){if(this.vsCodeApi)return this.vsCodeApi.getState();{const n=localStorage.getItem("vscodeState");return n?JSON.parse(n):void 0}}setState(n){return this.vsCodeApi?this.vsCodeApi.setState(n):(localStorage.setItem("vscodeState",JSON.stringify(n)),n)}}const S=new q;function z(){const[s,n]=d.useState([]),[t,r]=d.useState(null),[c,x]=d.useState(null),[o,m]=d.useState(null);d.useEffect(()=>{const a=j=>{const g=j.data;console.log("got message: ",g),n(g.contents)};return window.addEventListener("message",a),S.postMessage({type:"ready"}),()=>{window.removeEventListener("message",a)}},[]);const p=(a,j)=>{const g={type:"nodeEdit",contents:a,key:j};console.log("sending message: ",g),S.postMessage(g)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{ast:s,onEdit:p,selectedNodeId:t,selectedKey:c,setSelectedNodeId:r,setSelectedKey:x,insertTargetId:o,setInsertTargetId:m,children:e.jsx("div",{children:s.map(a=>e.jsx(F,{indent:0,node:a,children:e.jsx(l,{node:a,indent:0},a.id)}))})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Debug Info"}),e.jsxs("p",{children:["selectedNodeId: ",t]}),e.jsxs("p",{children:["selectedKey: ",c]}),e.jsxs("p",{children:["insertTargetId: ",o]})]})]})}E.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(z,{})}));
