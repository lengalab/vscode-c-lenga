var A=Object.defineProperty;var P=(e,n,r)=>n in e?A(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var v=(e,n,r)=>P(e,typeof n!="symbol"?n+"":n,r);import{b as m,j as t,R as S,c as _}from"./client.js";const E=m.createContext(null);function g(){const e=m.useContext(E);if(!e)throw new Error("LineContext must be used inside a provider");return e}function K(e){return{nodeMap:new Map,parentMap:new Map}}function c(e,n){const{selectedNodeId:r,selectedKey:a,onEdit:d,setSelectedNodeId:j,setSelectedKey:u}=g(),h=r==e.id&&a&&a==n,[p,i]=S.useState(String(e[n]??""));return S.useEffect(()=>{i(String(e[n]??""))},[e,n]),t.jsx("input",{className:"inline-editor",style:{...h?{backgroundColor:"rgba(255, 255, 255, 0.05)",boxShadow:"inset 0 -1px 0 0 rgba(163, 209, 252, 0.5)"}:{}},value:p,size:Math.max(1,p.length),onChange:l=>i(l.target.value),onFocus:()=>{u(n),j(e.id)},onBlur:()=>{e[n]=p,d(e,n)}})}function M({indent:e,node:n,children:r}){const{selectedNodeId:a,setSelectedNodeId:d,insertTargetId:j,setInsertTargetId:u,onEdit:h,nodeMap:p,parentMap:i}=g(),l=a===n.id,f=j===n.id,F=w=>{l&&w.key==="Enter"&&(w.preventDefault(),u(n.id))},D=w=>{if(!n)return;let s;switch(w){case"Declaration":{const o={id:crypto.randomUUID(),type:"StringLiteral",value:""};s={id:crypto.randomUUID(),type:"Declaration",data_type:"",name:"",initializer:o};break}case"ReturnStatement":{s={id:crypto.randomUUID(),type:"ReturnStatement",expression:void 0};break}case"UnknownNode":{s={id:crypto.randomUUID(),type:"UnknownNode",contents:""};break}case"PreprocInclude":{s={id:crypto.randomUUID(),type:"PreprocInclude",directive:""};break}case"FunctionParameter":{s={id:crypto.randomUUID(),type:"FunctionParameter",name:"",data_type:""};break}case"FunctionDeclaration":{s={id:crypto.randomUUID(),type:"FunctionDeclaration",name:"",return_type:"",params:[]};break}case"FunctionDefinition":{s={id:crypto.randomUUID(),type:"FunctionDefinition",name:"",return_type:"",params:[],body:{id:crypto.randomUUID(),type:"CompoundStatement",statements:[]}};break}case"CompoundStatement":{s={id:crypto.randomUUID(),type:"CompoundStatement",statements:[]};break}case"CallExpression":{s={id:crypto.randomUUID(),type:"CallExpression",identifier:"",idDeclaration:"",args:[]};break}case"Reference":{s={id:crypto.randomUUID(),type:"Reference",DeclRefId:""};break}case"AssignmentExpression":{s={id:crypto.randomUUID(),type:"AssignmentExpression",id_reference:"",value:{id:crypto.randomUUID(),type:"StringLiteral",value:""}};break}case"NumberLiteral":{s={id:crypto.randomUUID(),type:"NumberLiteral",value:""};break}case"StringLiteral":{s={id:crypto.randomUUID(),type:"StringLiteral",value:""};break}default:throw new Error("Unimplemented")}const R=i.get(n.id);if(!R)return;const{parent:y,key:L,index:C}=R;if(!y||!("statements"in y))return;const U=y.statements,k=[...U.slice(0,C+1),s,...U.slice(C+1)];y.statements=k,p.set(s.id,s),i.set(s.id,{parent:y,key:L,index:C+1}),u(null),h(y,null)};return t.jsxs("div",{tabIndex:0,onClick:()=>d(n.id),onKeyDown:F,style:{backgroundColor:l?"rgba(116, 116, 116, 0.05)":"transparent"},children:[t.jsx("div",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",paddingLeft:`${e*34}px`},children:r}),f&&t.jsxs("div",{style:{border:"1px solid #ccc",background:"black",position:"absolute"},children:[t.jsx("div",{onClick:()=>D("Declaration"),children:"Declaration"}),t.jsx("div",{onClick:()=>D("ReturnStatement"),children:"ReturnStatement"})]})]})}function x({node:e,indent:n}){switch(e.type){case"PreprocInclude":return t.jsx(V,{includeDecl:e});case"FunctionParameter":return t.jsx(b,{paramDecl:e});case"FunctionDeclaration":return t.jsx(T,{functionDeclaration:e});case"FunctionDefinition":return t.jsx(z,{funcDef:e,indent:n});case"Declaration":return t.jsx(B,{varDecl:e});case"ReturnStatement":return t.jsx(q,{returnStmt:e});case"CompoundStatement":return t.jsx(I,{compStmt:e,indent:n});case"IfStatement":return t.jsx(O,{ifStatement:e,indent:n});case"ElseClause":return t.jsx(N,{elseClause:e,indent:n});case"CallExpression":return t.jsx(J,{callExpr:e});case"Reference":return t.jsx(W,{declRefExpr:e});case"AssignmentExpression":return t.jsx($,{assignmentExpr:e});case"NumberLiteral":return t.jsx(G,{literalExpr:e});case"StringLiteral":return t.jsx(H,{literalExpr:e});case"BinaryExpression":return t.jsx(Q,{binaryExpression:e});default:return"WIP"}}function V({includeDecl:e}){return t.jsxs(t.Fragment,{children:["#include ","<",c(e,"directive"),">",";"]})}function T({functionDeclaration:e}){const{nodeMap:n}=g();return n.set(e.id,e),t.jsx(t.Fragment,{children:t.jsxs(t.Fragment,{children:[c(e,"return_type"),c(e,"name"),"(",e.params.map((r,a)=>t.jsxs(S.Fragment,{children:[a>0&&", ",t.jsx(b,{paramDecl:r})]},r.id)),")"]})})}function z({funcDef:e,indent:n}){const{nodeMap:r}=g();return r.set(e.id,e),t.jsxs(t.Fragment,{children:[c(e,"return_type"),c(e,"name"),"(",e.params.map((a,d)=>t.jsxs(S.Fragment,{children:[d>0&&", ",t.jsx(b,{paramDecl:a})]},a.id)),")",e.body&&t.jsx(I,{compStmt:e.body,indent:n})]})}function B({varDecl:e}){const{nodeMap:n}=g();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[c(e,"data_type"),c(e,"name"),e.initializer&&t.jsxs(t.Fragment,{children:["= ",t.jsx(x,{node:e.initializer,indent:0})]}),";"]})}function b({paramDecl:e}){const{nodeMap:n}=g();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[c(e,"data_type"),c(e,"name")]})}function I({compStmt:e,indent:n}){return t.jsxs(t.Fragment,{children:["{",e.statements.map(r=>t.jsx(M,{indent:n+1,node:r,children:t.jsx(x,{node:r,indent:n})})),"}"]})}function O({ifStatement:e,indent:n}){return t.jsxs(t.Fragment,{children:["if"," (",t.jsx(x,{node:e.condition,indent:0}),") ",t.jsx(I,{compStmt:e.compoundStatement,indent:n}),e.elseClause&&t.jsx(N,{elseClause:e.elseClause,indent:n})]})}function N({elseClause:e,indent:n}){return t.jsxs(t.Fragment,{children:["else"," ",t.jsx(I,{compStmt:e.compoundStatement,indent:n})]})}function q({returnStmt:e}){return t.jsxs(t.Fragment,{children:["return",e.expression&&t.jsxs(t.Fragment,{children:[" ",t.jsx(x,{node:e.expression,indent:0})]}),";"]})}function J({callExpr:e}){return t.jsxs(t.Fragment,{children:[c(e,"identifier"),"(",e.args.map((n,r)=>t.jsxs(S.Fragment,{children:[r>0&&", ",t.jsx(x,{node:n,indent:0})]},n.id)),");"]})}function W({declRefExpr:e}){const{nodeMap:n}=g(),r=n.get(e.DeclRefId);return!r||!("name"in r)?t.jsx(t.Fragment,{children:e.DeclRefId}):t.jsx(t.Fragment,{children:r.name})}function $({assignmentExpr:e}){const{nodeMap:n}=g(),r=n.get(e.id_reference);return!r||!("name"in r)?t.jsx(t.Fragment,{children:e.id_reference}):t.jsxs(t.Fragment,{children:[r.name," = ",t.jsx(x,{node:e.value,indent:0})]})}function G({literalExpr:e}){return t.jsx(t.Fragment,{children:c(e,"value")})}function H({literalExpr:e}){return t.jsx(t.Fragment,{children:c(e,"value")})}function Q({binaryExpression:e}){return t.jsxs(t.Fragment,{children:[t.jsx(x,{node:e.left,indent:0}),e.operator,t.jsx(x,{node:e.right,indent:0})]})}function X({ast:e,onEdit:n,selectedNodeId:r,selectedKey:a,setSelectedNodeId:d,setSelectedKey:j,insertTargetId:u,setInsertTargetId:h,children:p}){const{nodeMap:i,parentMap:l}=m.useMemo(()=>K(),[e]);return t.jsx(E.Provider,{value:{onEdit:n,selectedNodeId:r,selectedKey:a,setSelectedNodeId:d,setSelectedKey:j,nodeMap:i,parentMap:l,insertTargetId:u,setInsertTargetId:h},children:p})}class Y{constructor(){v(this,"vsCodeApi");typeof acquireVsCodeApi=="function"&&(this.vsCodeApi=acquireVsCodeApi())}postMessage(n){this.vsCodeApi?this.vsCodeApi.postMessage(n):console.log(n)}getState(){if(this.vsCodeApi)return this.vsCodeApi.getState();{const n=localStorage.getItem("vscodeState");return n?JSON.parse(n):void 0}}setState(n){return this.vsCodeApi?this.vsCodeApi.setState(n):(localStorage.setItem("vscodeState",JSON.stringify(n)),n)}}const Z=new Y;function ee(){const[e,n]=m.useState([]),[r,a]=m.useState(null),[d,j]=m.useState(null),[u,h]=m.useState(null);m.useEffect(()=>{const i=l=>{const f=l.data;n(f.contents)};return window.addEventListener("message",i),Z.postMessage({type:"ready"}),()=>{window.removeEventListener("message",i)}},[]);const p=(i,l)=>{const f={type:"nodeEdit",contents:i,key:l};n(F=>[...F]),console.log("sending message: ",f)};return t.jsxs(t.Fragment,{children:[t.jsx(X,{ast:e,onEdit:p,selectedNodeId:r,selectedKey:d,setSelectedNodeId:a,setSelectedKey:j,insertTargetId:u,setInsertTargetId:h,children:t.jsx("div",{children:e.map(i=>t.jsx(M,{indent:0,node:i,children:t.jsx(x,{node:i,indent:0},i.id)}))})}),t.jsxs("div",{children:[t.jsx("h1",{children:"Debug Info"}),t.jsxs("p",{children:["selectedNodeId: ",r]}),t.jsxs("p",{children:["selectedKey: ",d]}),t.jsxs("p",{children:["insertTargetId: ",u]})]})]})}_.createRoot(document.getElementById("root")).render(t.jsx(m.StrictMode,{children:t.jsx(ee,{})}));
