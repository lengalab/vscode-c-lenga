import{b as p,j as t,R as y,c as N}from"./client.js";const v=p.createContext(null);function g(){const e=p.useContext(v);if(!e)throw new Error("LineContext must be used inside a provider");return e}function z(e){const n=new Map,a=new Map;function i(r,o=null,d="",m=0){if(r)switch(n.set(r.id,r),o&&a.set(r.id,{parent:o,key:d,index:m}),r.type){case"FunctionDeclaration":{const s=r;s.params.forEach((c,l)=>i(c,s,"params",l));break}case"FunctionDefinition":{const s=r;s.params.forEach((c,l)=>i(c,s,"params",l)),i(s.body,r,"body",0);break}case"CompoundStatement":{r.statements.forEach((c,l)=>i(c,r,"statements",l));break}case"Declaration":{const s=r;s.initializer&&i(s.initializer,s,"initializer",0);break}case"ReturnStatement":{const s=r;s.expression&&i(s.expression,s,"expression",0);break}case"CallExpression":{const s=r;i(s,s,"calle",0),s.args.forEach((c,l)=>i(c,s,"args",l));break}case"AssignmentExpr":{i(r.value,r,"value",0);break}}}return e.forEach(r=>i(r)),{nodeMap:n,parentMap:a}}function A({ast:e,onEdit:n,selectedNodeId:a,setSelectedNodeId:i,insertTargetId:r,setInsertTargetId:o,children:d}){const{nodeMap:m,parentMap:s}=p.useMemo(()=>z(e),[e]);return t.jsx(v.Provider,{value:{onEdit:n,selectedNodeId:a,setSelectedNodeId:i,nodeMap:m,parentMap:s,insertTargetId:r,setInsertTargetId:o},children:d})}function u(e,n){const{onEdit:a}=g(),[i,r]=y.useState(String(e[n]??""));return y.useEffect(()=>{r(String(e[n]??""))},[e,n]),t.jsx("input",{className:"inline-editor",value:i,size:Math.max(1,i.length),onChange:o=>r(o.target.value),onInput:o=>{const d=o.target;d.size=Math.max(1,d.value.length)},onBlur:()=>{e[n]=i,a(e)}})}function h({indent:e,node:n,children:a}){const{selectedNodeId:i,setSelectedNodeId:r,insertTargetId:o,setInsertTargetId:d,onEdit:m,nodeMap:s,parentMap:c}=g(),l=i===n.id,S=o===n.id,C=E=>{l&&E.key==="Enter"&&(E.preventDefault(),d(n.id))},R=E=>{if(!n)return;let x;if(E==="Declaration"){const L={id:crypto.randomUUID(),type:"StringLiteral",value:""};x={id:crypto.randomUUID(),type:"Declaration",data_type:"",name:"",initializer:L}}else x={id:crypto.randomUUID(),type:"ReturnStatement",expression:void 0};const F=c.get(n.id);if(!F)return;const{parent:j,key:M,index:b}=F;if(!j||!("statements"in j))return;const I=j.statements,k=[...I.slice(0,b+1),x,...I.slice(b+1)];j.statements=k,s.set(x.id,x),c.set(x.id,{parent:j,key:M,index:b+1}),d(null),m(j)};return t.jsxs("div",{tabIndex:0,onClick:()=>r(n.id),onKeyDown:C,style:{backgroundColor:l?"rgba(0,120,215,0.2)":"transparent"},children:[t.jsxs("div",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace"},children:["    ".repeat(e),a]}),S&&t.jsxs("div",{style:{border:"1px solid #ccc",background:"black",position:"absolute"},children:[t.jsx("div",{onClick:()=>R("Declaration"),children:"Declaration"}),t.jsx("div",{onClick:()=>R("ReturnStatement"),children:"ReturnStatement"})]})]})}function f({node:e,indent:n}){switch(e.type){case"PreprocInclude":return t.jsx(P,{includeDecl:e,indent:n});case"FunctionDeclaration":throw new Error("Not implemented");case"FunctionDefinition":return t.jsx(_,{funcDef:e,indent:n});case"Declaration":return t.jsx(U,{varDecl:e,indent:n});case"FunctionParameter":return t.jsx(w,{paramDecl:e});case"CompoundStatement":return t.jsx(D,{compStmt:e,indent:n});case"ReturnStatement":return t.jsx(T,{returnStmt:e,indent:n});case"CallExpression":return t.jsx(V,{callExpr:e});case"Reference":return t.jsx(B,{declRefExpr:e});case"AssignmentExpr":return t.jsx(K,{assignmentExpr:e});case"NumberLiteral":return t.jsx(O,{literalExpr:e});case"StringLiteral":return t.jsx(W,{literalExpr:e});default:return"WIP"}}function P({includeDecl:e,indent:n}){return t.jsx(h,{indent:n,node:e,children:t.jsxs(t.Fragment,{children:["#include ","<",u(e,"directive"),">",";"]})})}function _({funcDef:e,indent:n}){const{nodeMap:a}=g();return a.set(e.id,e),t.jsxs(t.Fragment,{children:[t.jsx(h,{indent:n,node:e,children:t.jsxs(t.Fragment,{children:[u(e,"return_type"),u(e,"name"),"(",e.params.map((i,r)=>t.jsxs(y.Fragment,{children:[r>0&&", ",t.jsx(w,{paramDecl:i})]},i.id)),")","{"]})}),e.body&&t.jsx(D,{compStmt:e.body,indent:n+1}),t.jsx(h,{indent:n,node:e,children:"}"})]})}function U({varDecl:e,indent:n}){const{nodeMap:a}=g();return a.set(e.id,e),t.jsxs(h,{indent:n,node:e,children:[u(e,"data_type"),u(e,"name"),e.initializer&&t.jsxs(t.Fragment,{children:["= ",t.jsx(f,{node:e.initializer,indent:n})]}),";"]})}function w({paramDecl:e}){const{nodeMap:n}=g();return n.set(e.id,e),t.jsxs(t.Fragment,{children:[u(e,"data_type"),u(e,"name")]})}function D({compStmt:e,indent:n}){return e.statements.map(a=>t.jsx(f,{node:a,indent:n}))}function T({returnStmt:e,indent:n}){return t.jsxs(h,{indent:n,node:e,children:["return",e.expression&&t.jsxs(t.Fragment,{children:[" ",t.jsx(f,{node:e.expression,indent:0})]}),";"]})}function V({callExpr:e}){return t.jsxs(t.Fragment,{children:[u(e,"identifier"),"(",e.args.map((n,a)=>t.jsxs(y.Fragment,{children:[a>0&&", ",t.jsx(f,{node:n,indent:0})]},n.id)),");"]})}function B({declRefExpr:e}){const{nodeMap:n}=g(),a=n.get(e.DeclRefId);return!a||!("name"in a)?t.jsx(t.Fragment,{children:e.DeclRefId}):t.jsx(t.Fragment,{children:a.name})}function K({assignmentExpr:e}){return t.jsxs(t.Fragment,{children:["TODO assignmentExpr. node id: ",e.id]})}function O({literalExpr:e}){return t.jsx(t.Fragment,{children:u(e,"value")})}function W({literalExpr:e}){return t.jsx(t.Fragment,{children:u(e,"value")})}function q(){const[e,n]=p.useState([]),[a,i]=p.useState(null),[r,o]=p.useState(null),m=[{id:"0",name:"main",type:"FunctionDefinition",return_type:"int",params:[{type:"FunctionParameter",id:"1",name:"argv",data_type:"int"}],body:{id:"2",type:"CompoundStatement",statements:[{id:"3",type:"Declaration",name:"myVar",data_type:"int",initializer:{id:"4",type:"NumberLiteral",value:"58"}}]}}];p.useEffect(()=>{n(m)},[]);const s=c=>{const l={type:"nodeEdit",contents:c};n(S=>[...S]),console.log("sending message: ",l)};return t.jsxs(A,{ast:e,onEdit:s,selectedNodeId:a,setSelectedNodeId:i,insertTargetId:r,setInsertTargetId:o,children:[t.jsx("p",{children:"test"}),t.jsx("div",{children:e.map(c=>t.jsx(f,{node:c,indent:0},c.id))})]})}N.createRoot(document.getElementById("root")).render(t.jsx(p.StrictMode,{children:t.jsx(q,{})}));
